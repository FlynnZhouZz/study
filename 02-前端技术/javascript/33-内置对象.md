# å†…ç½®å¯¹è±¡

## å…¨å±€å¯¹è±¡ä¸å€¼

### 1. å…¨å±€å¯¹è±¡ï¼ˆGlobal Objectï¼‰

```js
// æµè§ˆå™¨ç¯å¢ƒï¼šwindowã€selfã€globalThis
// Node.jsç¯å¢ƒï¼šglobalã€globalThis

// ES2020 å¼•å…¥äº† globalThis
console.log(globalThis); // åœ¨æ‰€æœ‰ç¯å¢ƒä¸­éƒ½æŒ‡å‘å…¨å±€å¯¹è±¡

// å…¨å±€å±æ€§
console.log(Infinity); // æ— ç©·å¤§
console.log(NaN); // éæ•°å­—
console.log(undefined); // æœªå®šä¹‰
console.log(null); // ç©ºå€¼

// å…¨å±€å‡½æ•°
console.log(eval("2 + 2")); // 4ï¼ˆæ…ç”¨ï¼‰
console.log(parseInt("42px")); // 42
console.log(parseFloat("3.14em")); // 3.14
console.log(isNaN("hello")); // true
console.log(isFinite(Infinity)); // false
console.log(decodeURI("%E4%BD%A0%E5%A5%BD")); // "ä½ å¥½"
console.log(encodeURI("ä½ å¥½ä¸–ç•Œ")); // "%E4%BD%A0%E5%A5%BD%E4%B8%96%E7%95%8C"
```

### 2. å€¼å±æ€§

```js
// Infinity
console.log(1 / 0); // Infinity
console.log(-1 / 0); // -Infinity
console.log(Infinity > 1000); // true
console.log(Infinity + Infinity); // Infinity
console.log(Infinity * 0); // NaN

// NaN
console.log(0 / 0); // NaN
console.log(Math.sqrt(-1)); // NaN
console.log(NaN === NaN); // falseï¼ˆç‰¹æ®Šï¼‰
console.log(isNaN(NaN)); // true
console.log(Number.isNaN(NaN)); // trueï¼ˆES6 æ›´å®‰å…¨ï¼‰

// undefined å’Œ null
let x;
console.log(x); // undefined
console.log(typeof undefined); // "undefined"
console.log(typeof null); // "object"ï¼ˆå†å²é—ç•™ï¼‰
console.log(null == undefined); // true
console.log(null === undefined); // false
```

## åŸºæœ¬åŒ…è£…å¯¹è±¡

### 1. Boolean å¯¹è±¡

```js
// å¸ƒå°”å€¼ vs Booleanå¯¹è±¡
const bool = true; // åŸå§‹å€¼
const boolObj = new Boolean(true); // å¯¹è±¡

console.log(typeof bool); // "boolean"
console.log(typeof boolObj); // "object"
console.log(bool instanceof Boolean); // false
console.log(boolObj instanceof Boolean); // true

// è‡ªåŠ¨è£…ç®±
const str = "hello";
console.log(str.length); // 5ï¼ˆè‡ªåŠ¨åˆ›å»º String å¯¹è±¡ï¼‰

// Boolean è½¬æ¢è§„åˆ™
console.log(Boolean(0)); // false
console.log(Boolean(1)); // true
console.log(Boolean("")); // false
console.log(Boolean("hello")); // true
console.log(Boolean([])); // true
console.log(Boolean({})); // true
console.log(Boolean(null)); // false
console.log(Boolean(undefined)); // false
```

### 2. Number å¯¹è±¡

```js
// æ•°å€¼å¸¸é‡
console.log(Number.MAX_VALUE); // 1.7976931348623157e+308
console.log(Number.MIN_VALUE); // 5e-324
console.log(Number.MAX_SAFE_INTEGER); // 9007199254740991
console.log(Number.MIN_SAFE_INTEGER); // -9007199254740991
console.log(Number.POSITIVE_INFINITY); // Infinity
console.log(Number.NEGATIVE_INFINITY); // -Infinity
console.log(Number.EPSILON); // 2.220446049250313e-16
console.log(Number.NaN); // NaN

// Number æ–¹æ³•
console.log(Number.isFinite(Infinity)); // false
console.log(Number.isFinite(42)); // true
console.log(Number.isInteger(42.0)); // true
console.log(Number.isInteger(42.5)); // false
console.log(Number.isSafeInteger(Number.MAX_SAFE_INTEGER)); // true
console.log(Number.isSafeInteger(Number.MAX_SAFE_INTEGER + 1)); // false
console.log(Number.parseFloat("3.14px")); // 3.14
console.log(Number.parseInt("1010", 2)); // 10ï¼ˆäºŒè¿›åˆ¶è½¬æ¢ï¼‰

// æ•°å€¼æ ¼å¼åŒ–
const num = 123456.789;
console.log(num.toFixed(2)); // "123456.79"
console.log(num.toExponential(2)); // "1.23e+5"
console.log(num.toPrecision(4)); // "1.235e+5"
console.log(num.toLocaleString("zh-CN")); // "123,456.789"
console.log(num.toLocaleString("de-DE")); // "123.456,789"

// ç‰¹æ®Šæ•°å€¼å¤„ç†
console.log((0.1 + 0.2).toFixed(10)); // "0.3000000000"
console.log(Number.EPSILON); // æœ€å°ç²¾åº¦å€¼
```

### 3. String å¯¹è±¡

```js
// å­—ç¬¦ä¸²åˆ›å»º
const str1 = "Hello"; // å­—é¢é‡
const str2 = String("Hello"); // æ„é€ å‡½æ•°
const str3 = new String("Hello"); // Stringå¯¹è±¡ï¼ˆä¸æ¨èï¼‰

// å­—ç¬¦ä¸²å±æ€§
const str = "Hello World";
console.log(str.length); // 11
console.log(str[0]); // "H"ï¼ˆES5ï¼‰
console.log(str.charAt(0)); // "H"
console.log(str.charCodeAt(0)); // 72ï¼ˆASCIIï¼‰
console.log(str.codePointAt(0)); // 72ï¼ˆES6ï¼Œæ”¯æŒUnicodeï¼‰

// å­—ç¬¦ä¸²æŸ¥è¯¢
console.log(str.includes("World")); // trueï¼ˆES6ï¼‰
console.log(str.startsWith("Hello")); // trueï¼ˆES6ï¼‰
console.log(str.endsWith("World")); // trueï¼ˆES6ï¼‰
console.log(str.indexOf("o")); // 4
console.log(str.lastIndexOf("o")); // 7
console.log(str.search(/world/i)); // 6ï¼ˆæ­£åˆ™æœç´¢ï¼‰

// å­—ç¬¦ä¸²æ“ä½œ
console.log(str.slice(0, 5)); // "Hello"
console.log(str.substring(0, 5)); // "Hello"
console.log(str.substr(6, 5)); // "World"ï¼ˆå·²åºŸå¼ƒï¼‰
console.log(str.split(" ")); // ["Hello", "World"]
console.log(str.split(/(?= )/)); // ["Hello", " World"]ï¼ˆæ­£å‘é¢„æŸ¥ï¼‰

// å­—ç¬¦ä¸²ä¿®æ”¹
console.log(str.toLowerCase()); // "hello world"
console.log(str.toUpperCase()); // "HELLO WORLD"
console.log(str.trim()); // "Hello World"ï¼ˆå»æ‰ä¸¤ç«¯ç©ºç™½ï¼‰
console.log(str.trimStart()); // "Hello World"ï¼ˆES2019ï¼‰
console.log(str.trimEnd()); // "Hello World"ï¼ˆES2019ï¼‰
console.log(str.replace("World", "JavaScript")); // "Hello JavaScript"
console.log(str.replace(/[aeiou]/g, "*")); // "H*ll* W*rld"

// å­—ç¬¦ä¸²å¡«å……
console.log("5".padStart(3, "0")); // "005"ï¼ˆES2017ï¼‰
console.log("5".padEnd(3, "0")); // "500"ï¼ˆES2017ï¼‰

// æ¨¡æ¿å­—ç¬¦ä¸²ï¼ˆES6ï¼‰
const name = "John";
const age = 30;
console.log(`My name is ${name} and I'm ${age} years old.`);
console.log(String.raw`Hello\nWorld`); // "Hello\\nWorld"ï¼ˆåŸå§‹å­—ç¬¦ä¸²ï¼‰
```

## é›†åˆå¯¹è±¡

### 1. Array å¯¹è±¡

```js
// æ•°ç»„åˆ›å»º
const arr1 = [1, 2, 3]; // å­—é¢é‡
const arr2 = new Array(1, 2, 3); // æ„é€ å‡½æ•°
const arr3 = Array.of(1, 2, 3); // ES6
const arr4 = Array.from("123"); // ES6ï¼Œä»å¯è¿­ä»£å¯¹è±¡åˆ›å»º
const sparse = new Array(5); // åˆ›å»ºé•¿åº¦ä¸º5çš„ç©ºæ•°ç»„
const filled = Array(5).fill(0); // [0, 0, 0, 0, 0]

// æ•°ç»„å±æ€§
const arr = [1, 2, 3, 4, 5];
console.log(arr.length); // 5
arr.length = 3; // æˆªæ–­æ•°ç»„
console.log(arr); // [1, 2, 3]

// æ•°ç»„æ£€æµ‹
console.log(Array.isArray(arr)); // true
console.log(arr instanceof Array); // true

// æ•°ç»„è®¿é—®å’Œä¿®æ”¹
console.log(arr[0]); // 1
console.log(arr.at(-1)); // 3ï¼ˆES2022ï¼Œè´Ÿç´¢å¼•ï¼‰
arr[1] = 20; // ä¿®æ”¹å…ƒç´ 

// æ•°ç»„éå†
arr.forEach((item, index) => {
    console.log(item, index);
});

const doubled = arr.map(x => x * 2); // [2, 40, 6]
const filtered = arr.filter(x => x > 2); // [20, 3]
const sum = arr.reduce((acc, cur) => acc + cur, 0); // 24

// æ•°ç»„æŸ¥æ‰¾
console.log(arr.includes(20)); // trueï¼ˆES2016ï¼‰
console.log(arr.find(x => x > 10)); // 20ï¼ˆES6ï¼‰
console.log(arr.findIndex(x => x > 10)); // 1ï¼ˆES6ï¼‰
console.log(arr.indexOf(20)); // 1
console.log(arr.lastIndexOf(3)); // 2

// æ•°ç»„æ“ä½œ
const newArr = arr.concat([4, 5]); // [1, 20, 3, 4, 5]
console.log(arr.slice(1, 3)); // [20, 3]
console.log(arr.splice(1, 1, 99)); // è¿”å›åˆ é™¤çš„å…ƒç´ ï¼š[20]
console.log(arr); // [1, 99, 3]

// æ•°ç»„æ’åº
const nums = [3, 1, 4, 1, 5, 9];
console.log(nums.sort()); // [1, 1, 3, 4, 5, 9]
console.log(nums.sort((a, b) => b - a)); // é™åºï¼š[9, 5, 4, 3, 1, 1]
console.log(nums.reverse()); // [1, 1, 3, 4, 5, 9]

// æ•°ç»„è½¬æ¢
console.log(arr.join("-")); // "1-99-3"
console.log(arr.toString()); // "1,99,3"

// æ•°ç»„è§£æ„ï¼ˆES6ï¼‰
const [first, ...rest] = arr;
console.log(first, rest); // 1 [99, 3]
```

### 2. Map å¯¹è±¡

```js
// Map åˆ›å»º
const map = new Map();

// åŸºæœ¬æ“ä½œ
map.set("name", "John");
map.set("age", 30);
map.set({ id: 1 }, "object key"); // å¯¹è±¡ä½œä¸ºé”®

console.log(map.get("name")); // "John"
console.log(map.has("age")); // true
console.log(map.size); // 3

map.delete("age");
console.log(map.size); // 2

map.clear();
console.log(map.size); // 0

// åˆå§‹åŒ–
const map2 = new Map([
    ["key1", "value1"],
    ["key2", "value2"],
    ["key3", "value3"],
]);

// éå†
map2.forEach((value, key) => {
    console.log(key, value);
});

for (const [key, value] of map2) {
    console.log(key, value);
}

// è·å–é”®å€¼
console.log([...map2.keys()]); // ["key1", "key2", "key3"]
console.log([...map2.values()]); // ["value1", "value2", "value3"]
console.log([...map2.entries()]); // é”®å€¼å¯¹æ•°ç»„

// å¯¹è±¡è½¬Map
const obj = { a: 1, b: 2, c: 3 };
const map3 = new Map(Object.entries(obj));

// Mapè½¬å¯¹è±¡
const obj2 = Object.fromEntries(map3);
```

### 3. Set å¯¹è±¡

```js
// Set åˆ›å»º
const set = new Set();

// åŸºæœ¬æ“ä½œ
set.add(1);
set.add(2);
set.add(2); // é‡å¤ï¼Œä¸ä¼šæ·»åŠ 
set.add("text");
set.add({ a: 1 });

console.log(set.has(1)); // true
console.log(set.size); // 4

set.delete(1);
console.log(set.size); // 3

// åˆå§‹åŒ–
const set2 = new Set([1, 2, 3, 4, 4, 5]);
console.log(set2.size); // 5ï¼ˆå»é‡ï¼‰

// éå†
set2.forEach(value => {
    console.log(value);
});

for (const value of set2) {
    console.log(value);
}

// é›†åˆè¿ç®—
const setA = new Set([1, 2, 3]);
const setB = new Set([2, 3, 4]);

// å¹¶é›†
const union = new Set([...setA, ...setB]);
console.log([...union]); // [1, 2, 3, 4]

// äº¤é›†
const intersection = new Set([...setA].filter(x => setB.has(x)));
console.log([...intersection]); // [2, 3]

// å·®é›†
const difference = new Set([...setA].filter(x => !setB.has(x)));
console.log([...difference]); // [1]

// æ•°ç»„å»é‡
const arr = [1, 2, 2, 3, 4, 4, 5];
const unique = [...new Set(arr)];
console.log(unique); // [1, 2, 3, 4, 5]
```

### 4. WeakMap å’Œ WeakSet

```js
// WeakMap - é”®å¿…é¡»æ˜¯å¯¹è±¡ï¼Œå¼±å¼•ç”¨
const wm = new WeakMap();
let obj = { id: 1 };

wm.set(obj, "secret data");
console.log(wm.get(obj)); // "secret data"

obj = null; // objè¢«åƒåœ¾å›æ”¶æ—¶ï¼ŒWeakMapä¸­çš„æ¡ç›®ä¹Ÿä¼šè¢«è‡ªåŠ¨ç§»é™¤
// æ— æ³•éå†WeakMapï¼Œä¹Ÿæ²¡æœ‰sizeå±æ€§

// WeakSet - å€¼å¿…é¡»æ˜¯å¯¹è±¡ï¼Œå¼±å¼•ç”¨
const ws = new WeakSet();
let obj1 = { a: 1 };
let obj2 = { b: 2 };

ws.add(obj1);
ws.add(obj2);

console.log(ws.has(obj1)); // true

obj1 = null; // obj1è¢«åƒåœ¾å›æ”¶æ—¶ï¼Œè‡ªåŠ¨ä»WeakSetä¸­ç§»é™¤
```

## æ—¥æœŸä¸æ—¶é—´

### 1. Date å¯¹è±¡

```js
// åˆ›å»ºæ—¥æœŸ
const now = new Date(); // å½“å‰æ—¶é—´
const specific = new Date(2024, 0, 1); // 2024å¹´1æœˆ1æ—¥ï¼ˆæœˆä»½0-11ï¼‰
const fromString = new Date("2024-01-01T00:00:00");
const fromTimestamp = new Date(1704067200000); // æ—¶é—´æˆ³

// è·å–æ—¥æœŸç»„ä»¶
const date = new Date();
console.log(date.getFullYear()); // 2024
console.log(date.getMonth()); // 0-11
console.log(date.getDate()); // 1-31
console.log(date.getDay()); // 0-6ï¼ˆ0=å‘¨æ—¥ï¼‰
console.log(date.getHours()); // 0-23
console.log(date.getMinutes()); // 0-59
console.log(date.getSeconds()); // 0-59
console.log(date.getMilliseconds()); // 0-999

// UTC æ–¹æ³•
console.log(date.getUTCFullYear()); // UTCå¹´ä»½
console.log(date.getUTCHours()); // UTCå°æ—¶

// è®¾ç½®æ—¥æœŸ
date.setFullYear(2025);
date.setMonth(11); // 12æœˆ
date.setDate(25);
date.setHours(12, 30, 0, 0); // 12:30:00.000

// æ—¥æœŸæ ¼å¼åŒ–
console.log(date.toString()); // "Tue Dec 25 2024 12:30:00 GMT+0800"
console.log(date.toDateString()); // "Tue Dec 25 2024"
console.log(date.toTimeString()); // "12:30:00 GMT+0800"
console.log(date.toISOString()); // "2024-12-25T04:30:00.000Z"
console.log(date.toUTCString()); // "Wed, 25 Dec 2024 04:30:00 GMT"
console.log(date.toLocaleString()); // æœ¬åœ°åŒ–æ ¼å¼
console.log(date.toLocaleDateString("zh-CN")); // "2024/12/25"
console.log(date.toLocaleTimeString("en-US")); // "12:30:00 PM"

// æ—¶é—´æˆ³
console.log(date.getTime()); // æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
console.log(Date.now()); // å½“å‰æ—¶é—´æˆ³
console.log(date.valueOf()); // åŒgetTime()

// æ—¥æœŸè¿ç®—
const start = new Date();
// ... æ‰§è¡Œä¸€äº›æ“ä½œ
const end = new Date();
const duration = end - start; // æ¯«ç§’å·®

// æ—¥æœŸæ¯”è¾ƒ
const d1 = new Date(2024, 0, 1);
const d2 = new Date(2024, 0, 2);
console.log(d1 < d2); // true
console.log(d1.getTime() === d2.getTime()); // ç²¾ç¡®æ¯”è¾ƒ
```

### 2. å›½é™…åŒ– APIï¼ˆIntlï¼‰

```js
// æ•°å­—æ ¼å¼åŒ–
const number = 1234567.89;

const formatter = new Intl.NumberFormat("zh-CN", {
    style: "currency",
    currency: "CNY",
    minimumFractionDigits: 2,
});
console.log(formatter.format(number)); // "Â¥1,234,567.89"

const percent = new Intl.NumberFormat("en-US", {
    style: "percent",
    minimumFractionDigits: 1,
});
console.log(percent.format(0.123)); // "12.3%"

// æ—¥æœŸæ ¼å¼åŒ–
const date = new Date();
const dateFormatter = new Intl.DateTimeFormat("zh-CN", {
    year: "numeric",
    month: "long",
    day: "numeric",
    weekday: "long",
    hour: "2-digit",
    minute: "2-digit",
    second: "2-digit",
    timeZone: "Asia/Shanghai",
});
console.log(dateFormatter.format(date)); // "2024å¹´1æœˆ1æ—¥æ˜ŸæœŸä¸€ 12:30:00"

// ç›¸å¯¹æ—¶é—´æ ¼å¼åŒ–
const rtf = new Intl.RelativeTimeFormat("zh-CN", {
    numeric: "auto",
});
console.log(rtf.format(-1, "day")); // "æ˜¨å¤©"
console.log(rtf.format(2, "week")); // "2å‘¨å"

// åˆ—è¡¨æ ¼å¼åŒ–
const list = ["è‹¹æœ", "é¦™è•‰", "æ©™å­"];
const listFormatter = new Intl.ListFormat("zh-CN", {
    style: "long",
    type: "conjunction",
});
console.log(listFormatter.format(list)); // "è‹¹æœã€é¦™è•‰å’Œæ©™å­"

// æ’åº
const words = ["å¼ ä¸‰", "æå››", "ç‹äº”"];
const collator = new Intl.Collator("zh-CN");
console.log(words.sort(collator.compare)); // æŒ‰ä¸­æ–‡æ‹¼éŸ³æ’åº
```

## æ•°å­¦ä¸æ•°å­—

### 1. Math å¯¹è±¡

```js
// æ•°å­¦å¸¸æ•°
console.log(Math.PI); // 3.141592653589793
console.log(Math.E); // 2.718281828459045
console.log(Math.LN2); // 0.6931471805599453
console.log(Math.LN10); // 2.302585092994046
console.log(Math.LOG2E); // 1.4426950408889634
console.log(Math.LOG10E); // 0.4342944819032518
console.log(Math.SQRT2); // 1.4142135623730951
console.log(Math.SQRT1_2); // 0.7071067811865476

// èˆå…¥æ–¹æ³•
console.log(Math.round(4.7)); // 5
console.log(Math.ceil(4.1)); // 5
console.log(Math.floor(4.9)); // 4
console.log(Math.trunc(4.9)); // 4ï¼ˆES6ï¼‰
console.log(Math.round(-4.5)); // -4
console.log(Math.floor(-4.5)); // -5

// éšæœºæ•°
console.log(Math.random()); // 0-1ä¹‹é—´çš„éšæœºæ•°
function randomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

// æœ€å¤§å€¼/æœ€å°å€¼
console.log(Math.max(1, 2, 3, 4, 5)); // 5
console.log(Math.min(1, 2, 3, 4, 5)); // 1
console.log(Math.max(...[1, 2, 3, 4, 5])); // 5ï¼ˆä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ï¼‰

// ç»å¯¹å€¼
console.log(Math.abs(-10)); // 10

// æŒ‡æ•°å’Œå¯¹æ•°
console.log(Math.pow(2, 3)); // 8
console.log(2 ** 3); // 8ï¼ˆES7ï¼‰
console.log(Math.sqrt(16)); // 4
console.log(Math.cbrt(27)); // 3ï¼ˆç«‹æ–¹æ ¹ï¼ŒES6ï¼‰
console.log(Math.exp(1)); // Math.E
console.log(Math.log(Math.E)); // 1
console.log(Math.log10(100)); // 2ï¼ˆES6ï¼‰
console.log(Math.log2(8)); // 3ï¼ˆES6ï¼‰

// ä¸‰è§’å‡½æ•°
console.log(Math.sin(Math.PI / 2)); // 1
console.log(Math.cos(Math.PI)); // -1
console.log(Math.tan(Math.PI / 4)); // 0.9999999999999999
console.log(Math.asin(1)); // Ï€/2
console.log(Math.acos(0)); // Ï€/2
console.log(Math.atan(1)); // Ï€/4
console.log(Math.atan2(1, 1)); // Ï€/4

// åŒæ›²å‡½æ•°
console.log(Math.sinh(0)); // 0
console.log(Math.cosh(0)); // 1
console.log(Math.tanh(0)); // 0

// å…¶ä»–
console.log(Math.sign(-5)); // -1ï¼ˆES6ï¼‰
console.log(Math.sign(0)); // 0
console.log(Math.sign(5)); // 1
console.log(Math.clz32(1)); // 31ï¼ˆå‰å¯¼0çš„ä¸ªæ•°ï¼ŒES6ï¼‰
console.log(Math.imul(2, 3)); // 6ï¼ˆ32ä½ä¹˜æ³•ï¼ŒES6ï¼‰
console.log(Math.fround(1.337)); // å•ç²¾åº¦æµ®ç‚¹æ•°ï¼ˆES6ï¼‰
console.log(Math.hypot(3, 4)); // 5ï¼ˆæ¬§å‡ é‡Œå¾—è·ç¦»ï¼ŒES6ï¼‰
```

### 2. BigInt

```js
// BigInt åˆ›å»º
const big1 = 123456789012345678901234567890n;
const big2 = BigInt("123456789012345678901234567890");
const big3 = BigInt(Number.MAX_SAFE_INTEGER) + 1n;

console.log(typeof big1); // "bigint"

// è¿ç®—
console.log(big1 + big2); // åŠ æ³•
console.log(big1 - big2); // å‡æ³•
console.log(big1 * big2); // ä¹˜æ³•
console.log(big1 / big2); // é™¤æ³•ï¼ˆå–æ•´ï¼‰
console.log(big1 % big2); // å–ä½™
console.log(big1 ** 2n); // å¹‚è¿ç®—

// æ¯”è¾ƒ
console.log(1n < 2n); // true
console.log(1n == 1); // trueï¼ˆå®½æ¾ç›¸ç­‰ï¼‰
console.log(1n === 1); // falseï¼ˆä¸¥æ ¼ä¸ç›¸ç­‰ï¼‰

// ä½è¿ç®—
console.log(5n & 3n); // 1nï¼ˆæŒ‰ä½ä¸ï¼‰
console.log(5n | 3n); // 7nï¼ˆæŒ‰ä½æˆ–ï¼‰
console.log(5n ^ 3n); // 6nï¼ˆæŒ‰ä½å¼‚æˆ–ï¼‰
console.log(~5n); // -6nï¼ˆæŒ‰ä½éï¼‰
console.log(5n << 2n); // 20nï¼ˆå·¦ç§»ï¼‰
console.log(5n >> 1n); // 2nï¼ˆå³ç§»ï¼‰

// è½¬æ¢
console.log(Number(123n)); // 123
console.log(String(123n)); // "123"
console.log(Boolean(0n)); // false
console.log(Boolean(1n)); // true
```

## æ­£åˆ™è¡¨è¾¾å¼

### 1. RegExp å¯¹è±¡

```js
// åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼
const regex1 = /pattern/flags;           // å­—é¢é‡
const regex2 = new RegExp('pattern', 'flags'); // æ„é€ å‡½æ•°

// æ ‡å¿—
// g - å…¨å±€åŒ¹é…
// i - ä¸åŒºåˆ†å¤§å°å†™
// m - å¤šè¡ŒåŒ¹é…
// s - ç‚¹å·åŒ¹é…æ‰€æœ‰å­—ç¬¦ï¼ˆES2018ï¼‰
// u - Unicodeæ¨¡å¼
// y - ç²˜æ€§åŒ¹é…
// d - ç”Ÿæˆç´¢å¼•ï¼ˆES2022ï¼‰

const regex = /hello/gi;

// æ­£åˆ™æ–¹æ³•
const str = 'Hello hello HELLO';
console.log(regex.test(str));           // true
console.log(str.match(regex));          // ["Hello", "hello", "HELLO"]
console.log(str.search(regex));         // 0
console.log(str.replace(regex, 'Hi'));  // "Hi Hi Hi"
console.log(str.split(/hello/i));       // ["", " ", " ", ""]

// æ­£åˆ™å±æ€§
console.log(regex.source);              // "hello"
console.log(regex.flags);               // "gi"
console.log(regex.global);              // true
console.log(regex.ignoreCase);          // true
console.log(regex.multiline);           // false

// æ•è·ç»„
const dateRegex = /(\d{4})-(\d{2})-(\d{2})/;
const dateStr = '2024-01-01';
const match = dateRegex.exec(dateStr);
console.log(match[0]);                  // "2024-01-01"
console.log(match[1]);                  // "2024"
console.log(match[2]);                  // "01"
console.log(match[3]);                  // "01"

// å‘½åæ•è·ç»„ï¼ˆES2018ï¼‰
const namedRegex = /(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/;
const namedMatch = namedRegex.exec(dateStr);
console.log(namedMatch.groups.year);    // "2024"
console.log(namedMatch.groups.month);   // "01"
console.log(namedMatch.groups.day);     // "01"

// åè¡Œæ–­è¨€ï¼ˆES2018ï¼‰
console.log(/(?<=\$)\d+/.exec('$100')[0]);   // "100"ï¼ˆåè¡Œæ–­è¨€ï¼‰
console.log(/\d+(?=%)/.exec('100%')[0]);     // "100"ï¼ˆå…ˆè¡Œæ–­è¨€ï¼‰

// Unicode å±æ€§ï¼ˆES2018ï¼‰
console.log(/\p{Script=Han}/u.test('æ±‰'));   // trueï¼ˆåŒ¹é…æ±‰å­—ï¼‰
console.log(/\p{Emoji}/u.test('ğŸ˜€'));       // trueï¼ˆåŒ¹é…è¡¨æƒ…ç¬¦å·ï¼‰

// ç´¢å¼•æ•è·ï¼ˆES2022ï¼‰
const regexWithIndices = /(\d{4})-(\d{2})-(\d{2})/d;
const indicesMatch = regexWithIndices.exec('Date: 2024-01-01');
console.log(indicesMatch.indices);
// [[10, 20], [10, 14], [15, 17], [18, 20]]

// ç²˜æ€§åŒ¹é…ï¼ˆyæ ‡å¿—ï¼‰
const stickyRegex = /hello/y;
stickyRegex.lastIndex = 0;
console.log(stickyRegex.test('hello')); // true
console.log(stickyRegex.lastIndex);     // 5
console.log(stickyRegex.test('hello')); // falseï¼ˆå¿…é¡»ä»lastIndexå¼€å§‹ï¼‰
```

## é”™è¯¯å¤„ç†å¯¹è±¡

### 1. Error å¯¹è±¡

```js
// å†…ç½®é”™è¯¯ç±»å‹
try {
    throw new Error("æ™®é€šé”™è¯¯");
} catch (e) {
    console.log(e.name); // "Error"
    console.log(e.message); // "æ™®é€šé”™è¯¯"
    console.log(e.stack); // å †æ ˆè·Ÿè¸ª
}

// ç‰¹å®šé”™è¯¯ç±»å‹
try {
    throw new TypeError("ç±»å‹é”™è¯¯");
} catch (e) {
    console.log(e instanceof TypeError); // true
}

// è‡ªå®šä¹‰é”™è¯¯
class CustomError extends Error {
    constructor(message, code) {
        super(message);
        this.name = this.constructor.name;
        this.code = code;
        this.timestamp = new Date();

        // ä¿æŒæ­£ç¡®çš„å †æ ˆè·Ÿè¸ª
        if (Error.captureStackTrace) {
            Error.captureStackTrace(this, this.constructor);
        }
    }
}

try {
    throw new CustomError("è‡ªå®šä¹‰é”™è¯¯", "CUSTOM_001");
} catch (e) {
    console.log(e.name); // "CustomError"
    console.log(e.code); // "CUSTOM_001"
}

// AggregateErrorï¼ˆES2021ï¼‰
try {
    throw new AggregateError(
        [new Error("é”™è¯¯1"), new Error("é”™è¯¯2"), new Error("é”™è¯¯3")],
        "å¤šä¸ªé”™è¯¯å‘ç”Ÿ"
    );
} catch (e) {
    console.log(e.name); // "AggregateError"
    console.log(e.message); // "å¤šä¸ªé”™è¯¯å‘ç”Ÿ"
    console.log(e.errors.length); // 3
}
```

## å…¶ä»–å†…ç½®å¯¹è±¡

### 1. JSON å¯¹è±¡

```js
const obj = {
    name: "John",
    age: 30,
    hobbies: ["reading", "coding"],
    address: {
        city: "New York",
        zip: "10001",
    },
    date: new Date(),
    score: 95.5,
    isAdmin: true,
    salary: null,
    undefinedProp: undefined,
    func: function () {
        return "hi";
    },
};

// JSON.stringify
const jsonStr = JSON.stringify(obj);
console.log(jsonStr);
// {"name":"John","age":30,"hobbies":["reading","coding"],"address":{...}}

// è‡ªå®šä¹‰åºåˆ—åŒ–
const customJson = JSON.stringify(
    obj,
    (key, value) => {
        if (typeof value === "function") return undefined;
        if (value instanceof Date) return value.toISOString();
        if (typeof value === "number") return Math.round(value);
        return value;
    },
    2
); // ç¼©è¿›2ä¸ªç©ºæ ¼

// JSON.parse
const parsed = JSON.parse(jsonStr);
console.log(parsed.name); // "John"

// è‡ªå®šä¹‰è§£æ
const reviver = (key, value) => {
    if (key === "date") return new Date(value);
    return value;
};
const parsedWithDate = JSON.parse(jsonStr, reviver);

// é”™è¯¯å¤„ç†
try {
    JSON.parse("invalid json");
} catch (e) {
    console.error("JSONè§£æé”™è¯¯:", e.message);
}
```

### 2. Promise å¯¹è±¡

```js
// Promise åˆ›å»º
const promise = new Promise((resolve, reject) => {
    setTimeout(() => {
        Math.random() > 0.5 ? resolve("æˆåŠŸ") : reject("å¤±è´¥");
    }, 1000);
});

// Promise ä½¿ç”¨
promise
    .then(result => console.log("æˆåŠŸ:", result))
    .catch(error => console.error("å¤±è´¥:", error))
    .finally(() => console.log("å®Œæˆ"));

// Promise é™æ€æ–¹æ³•
Promise.resolve("ç«‹å³è§£å†³").then(console.log);
Promise.reject("ç«‹å³æ‹’ç»").catch(console.error);

// Promise.all - æ‰€æœ‰æˆåŠŸ
Promise.all([Promise.resolve(1), Promise.resolve(2), Promise.resolve(3)]).then(results =>
    console.log("all:", results)
); // [1, 2, 3]

// Promise.allSettled - æ‰€æœ‰å®Œæˆï¼ˆES2020ï¼‰
Promise.allSettled([Promise.resolve(1), Promise.reject("é”™è¯¯"), Promise.resolve(3)]).then(results =>
    console.log("allSettled:", results)
);

// Promise.race - ç¬¬ä¸€ä¸ªå®Œæˆ
Promise.race([
    new Promise(resolve => setTimeout(() => resolve("å¿«"), 100)),
    new Promise(resolve => setTimeout(() => resolve("æ…¢"), 200)),
]).then(console.log); // "å¿«"

// Promise.any - ç¬¬ä¸€ä¸ªæˆåŠŸï¼ˆES2021ï¼‰
Promise.any([Promise.reject("é”™è¯¯1"), Promise.resolve("æˆåŠŸ1"), Promise.resolve("æˆåŠŸ2")]).then(
    console.log
); // "æˆåŠŸ1"

// async/await
async function fetchData() {
    try {
        const result = await promise;
        console.log("è·å–ç»“æœ:", result);
    } catch (error) {
        console.error("é”™è¯¯:", error);
    }
}
```

### 3. Proxy å’Œ Reflect

```js
// Proxy ç¤ºä¾‹
const target = { name: "John", age: 30 };
const handler = {
    get(obj, prop) {
        console.log(`è·å–å±æ€§: ${prop}`);
        return prop in obj ? obj[prop] : "é»˜è®¤å€¼";
    },
    set(obj, prop, value) {
        console.log(`è®¾ç½®å±æ€§: ${prop} = ${value}`);
        if (prop === "age" && value < 0) {
            throw new Error("å¹´é¾„ä¸èƒ½ä¸ºè´Ÿ");
        }
        obj[prop] = value;
        return true;
    },
};

const proxy = new Proxy(target, handler);
console.log(proxy.name); // "John"
console.log(proxy.unknown); // "é»˜è®¤å€¼"
proxy.age = 25; // æ­£å¸¸
// proxy.age = -5;            // æŠ›å‡ºé”™è¯¯

// Reflect ç¤ºä¾‹
const obj = { x: 1, y: 2 };
console.log(Reflect.get(obj, "x")); // 1
console.log(Reflect.set(obj, "z", 3)); // true
console.log(Reflect.has(obj, "x")); // true
console.log(Reflect.deleteProperty(obj, "y")); // true
console.log(Reflect.ownKeys(obj)); // ["x", "z"]
```

## æœ€ä½³å®è·µ

### 1. å¯¹è±¡é€‰æ‹©æŒ‡å—

```js
// 1. æ•°æ®å­˜å‚¨
// - ç®€å•å¯¹è±¡ï¼šä½¿ç”¨æ™®é€šå¯¹è±¡ {}
// - é”®å€¼å¯¹é›†åˆï¼šä½¿ç”¨ Mapï¼ˆé”®å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼‰
// - å”¯ä¸€å€¼é›†åˆï¼šä½¿ç”¨ Setï¼ˆè‡ªåŠ¨å»é‡ï¼‰
// - å¼±å¼•ç”¨é›†åˆï¼šä½¿ç”¨ WeakMap/WeakSet

// 2. æ•°ç»„å¤„ç†
// - åŸºæœ¬æ“ä½œï¼šä½¿ç”¨ Array æ–¹æ³•ï¼ˆmapã€filterã€reduceç­‰ï¼‰
// - é«˜æ€§èƒ½æ•°å€¼è®¡ç®—ï¼šä½¿ç”¨ TypedArray
// - å¤§æ•´æ•°ï¼šä½¿ç”¨ BigInt

// 3. å­—ç¬¦ä¸²æ“ä½œ
// - åŸºæœ¬æ“ä½œï¼šä½¿ç”¨ String æ–¹æ³•
// - æ¨¡æ¿å­—ç¬¦ä¸²ï¼šä½¿ç”¨åå¼•å· ``
// - å¤æ‚æ›¿æ¢ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼

// 4. æ—¥æœŸå¤„ç†
// - åŸºæœ¬æ“ä½œï¼šä½¿ç”¨ Date å¯¹è±¡
// - å¤æ‚æ ¼å¼åŒ–ï¼šä½¿ç”¨ Intl.DateTimeFormat
// - æ—¶åŒºå¤„ç†ï¼šä½¿ç”¨ moment.js æˆ– date-fns åº“

// 5. æ•°å­¦è®¡ç®—
// - åŸºæœ¬è¿ç®—ï¼šä½¿ç”¨ Math å¯¹è±¡
// - å¤æ‚è®¡ç®—ï¼šè€ƒè™‘ä½¿ç”¨ä¸“é—¨çš„æ•°å­¦åº“

// 6. é”™è¯¯å¤„ç†
// - ç”¨æˆ·é”™è¯¯ï¼šä½¿ç”¨å†…ç½® Error ç±»å‹
// - è‡ªå®šä¹‰é”™è¯¯ï¼šç»§æ‰¿ Error ç±»
// - å¤šä¸ªé”™è¯¯ï¼šä½¿ç”¨ AggregateError
```

### 2. æ€§èƒ½ä¼˜åŒ–å»ºè®®

```js
// 1. é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º
// âŒ ä¸å¥½çš„åšæ³•
for (let i = 0; i < 1000; i++) {
    const obj = new Object(); // æ¯æ¬¡å¾ªç¯åˆ›å»ºæ–°å¯¹è±¡
    // ...
}

// âœ… å¥½çš„åšæ³•
let obj = {};
for (let i = 0; i < 1000; i++) {
    // é‡ç”¨å¯¹è±¡
    Object.assign(obj, { /* æ–°å±æ€§ */ });
    // ...
}

// 2. ä½¿ç”¨åˆé€‚çš„æ•°æ®ç»“æ„
// é¢‘ç¹æŸ¥æ‰¾ï¼šä½¿ç”¨ Map è€Œä¸æ˜¯å¯¹è±¡
// å”¯ä¸€å€¼ï¼šä½¿ç”¨ Set è€Œä¸æ˜¯æ•°ç»„
// æ•°å€¼æ•°ç»„ï¼šä½¿ç”¨ TypedArray

// 3. ç¼“å­˜è®¡ç®—ç»“æœ
const cache = new Map();
function expensiveOperation(input) {
    if (cache.has(input)) {
        return cache.get(input);
    }
    const result = /* è®¡ç®— */;
    cache.set(input, result);
    return result;
}

// 4. é¿å…æ·±åº¦å¤åˆ¶
// ä½¿ç”¨æµ…å¤åˆ¶ï¼š{...obj}, Object.assign(), slice()
// å¿…è¦æ—¶æ‰ä½¿ç”¨æ·±å¤åˆ¶ï¼šJSON.parse(JSON.stringify()), structuredClone()
```

### 3. å…¼å®¹æ€§è€ƒè™‘

```js
// ç‰¹æ€§æ£€æµ‹
if (typeof BigInt !== "undefined") {
    // æ”¯æŒ BigInt
    const big = 123n;
} else {
    // é™çº§æ–¹æ¡ˆ
    console.warn("BigInt not supported");
}

// Polyfill ç¤ºä¾‹
if (!Array.prototype.flat) {
    Array.prototype.flat = function (depth = 1) {
        return this.reduce((acc, val) => {
            if (Array.isArray(val) && depth > 0) {
                acc.push(...val.flat(depth - 1));
            } else {
                acc.push(val);
            }
            return acc;
        }, []);
    };
}

// ä½¿ç”¨ babel æˆ– core-js è¿›è¡Œ polyfill
```
